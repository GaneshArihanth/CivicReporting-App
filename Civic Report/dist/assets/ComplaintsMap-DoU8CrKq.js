import{f as E,r as a,j as n}from"./vendor-BvpsvYBk.js";import{L as d}from"./leaflet-Bd0cCGXt.js";import"./index-DRuuUDDM.js";import"./recharts-BDxj_m0B.js";const S="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAApCAYAAADAk4LOAAAFgUlEQVR4Aa1XA5BjWRTN2oW17d3YaZtr2962HUzbDNpjszW24mRt28p47v7zq/bXZtrp/lWnXr337j3nPCe85NcypgSFdugCpW5YoDAMRaIMqRi6aKq5E3YqDQO3qAwjVWrD8Ncq/RBpykd8oZUb/kaJutow8r1aP9II0WmLKLIsJyv1w/kqw9Ch2MYdB++12Onxee/QMwvf4/Dk/Lfp/i4nxTXtOoQ4pW5Aj7wpici1A9erdAN2OH64x8OSP9j3Ft3b7aWkTg/Fm91siTra0f9on5sQr9INejH6CUUUpavjFNq1B+Oadhxmnfa8RfEmN8VNAsQhPqF55xHkMzz3jSmChWU6f7/XZKNH+9+hBLOHYozuKQPxyMPUKkrX/K0uWnfFaJGS1QPRtZsOPtr3NsW0uyh6NNCOkU3Yz+bXbT3I8G3xE5EXLXtCXbbqwCO9zPQYPRTZ5vIDXD7U+w7rFDEoUUf7ibHIR4y6bLVPXrz8JVZEql13trxwue/uDivd3fkWRbS6/IA2bID4uk0UpF1N8qLlbBlXs4Ee7HLTfV1j54APvODnSfOWBqtKVvjgLKzF5YdEk5ewRkGlK0i33Eofffc7HT56jD7/6U+qH3Cx7SBLNntH5YIPvODnyfIXZYRVDPqgHtLs5ABHD3YzLuespb7t79FY34DjMwrVrcTuwlT55YMPvOBnRrJ4VXTdNnYug5ucHLBjEpt30701A3Ts+HEa73u6dT3FNWwflY86eMHPk+Yu+i6pzUpRrW7SNDg5JHR4KapmM5Wv2E8Tfcb1HoqqHMHU+uWDD7zg54mz5/2BSnizi9T1Dg4QQXLToGNCkb6tb1NU+QAlGr1++eADrzhn/u8Q2YZhQVlZ5+CAOtqfbhmaUCS1ezNFVm2imDbPmPng5wmz+gwh+oHDce0eUtQ6OGDIyR0uUhUsoO3vfDmmgOezH0mZN59x7MBi++WDL1g/eEiU3avlidO671bkLfwbw5XV2P8Pzo0ydy4t2/0eu33xYSOMOD8hTf4CrBtGMSoXfPLchX+J0ruSePw3LZeK0juPJbYzrhkH0io7B3k164hiGvawhOKMLkrQLyVpZg8rHFW7E2uHOL888IBPlNZ1FPzstSJM694fWr6RwpvcJK60+0HCILTBzZLFNdtAzJaohze60T8qBzyh5ZuOg5e7uwQppofEmf2++DYvmySqGBuKaicF1blQjhuHdvCIMvp8whTTfZzI7RldpwtSzL+F1+wkdZ2TBOW2gIF88PBTzD/gpeREAMEbxnJcaJHNHrpzji0gQCS6hdkEeYt9DF/2qPcEC8RM28Hwmr3sdNyht00byAut2k3gufWNtgtOEOFGUwcXWNDbdNbpgBGxEvKkOQsxivJx33iow0Vw5S6SVTrpVq11ysA2Rp7gTfPfktc6zhtXBBC+adRLshf6sG2RfHPZ5EAc4sVZ83yCN00Fk/4kggu40ZTvIEm5g24qtU4KjBrx/BTTH8ifVASAG7gKrnWxJDcU7x8X6Ecczhm3o6YicvsLXWfh3Ch1W0k8x0nXF+0fFxgt4phz8QvypiwCCFKMqXCnqXExjq10beH+UUA7+nG6mdG/Pu0f3LgFcGrl2s0kNNjpmoJ9o4B29CMO8dMT4Q5ox8uitF6fqsrJOr8qnwNbRzv6hSnG5wP+64C7h9lp30hKNtKdWjtdkbuPA19nJ7Tz3zR/ibgARbhb4AlhavcBebmTHcFl2fvYEnW0ox9xMxKBS8btJ+KiEbq9zA4RthQXDhPa0T9TEe69gWupwc6uBUphquXgf+/FrIjweHQS4/pduMe5ERUMHUd9xv8ZR98CxkS4F2n3EUrUZ10EYNw7BWm9x1GiPssi3GgiGRDKWRYZfXlON+dfNbM+GgIwYdwAAAAASUVORK5CYII=",M="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACkAAAApCAQAAAACach9AAACMUlEQVR4Ae3ShY7jQBAE0Aoz/f9/HTMzhg1zrdKUrJbdx+Kd2nD8VNudfsL/Th///dyQN2TH6f3y/BGpC379rV+S+qqetBOxImNQXL8JCAr2V4iMQXHGNJxeCfZXhSRBcQMfvkOWUdtfzlLgAENmZDcmo2TVmt8OSM2eXxBp3DjHSMFutqS7SbmemzBiR+xpKCNUIRkdkkYxhAkyGoBvyQFEJEefwSmmvBfJuJ6aKqKWnAkvGZOaZXTUgFqYULWNSHUckZuR1HIIimUExutRxwzOLROIG4vKmCKQt364mIlhSyzAf1m9lHZHJZrlAOMMztRRiKimp/rpdJDc9Awry5xTZCte7FHtuS8wJgeYGrex28xNTd086Dik7vUMscQOa8y4DoGtCCSkAKlNwpgNtphjrC6MIHUkR6YWxxs6Sc5xqn222mmCRFzIt8lEdKx+ikCtg91qS2WpwVfBelJCiQJwvzixfI9cxZQWgiSJelKnwBElKYtDOb2MFbhmUigbReQBV0Cg4+qMXSxXSyGUn4UbF8l+7qdSGnTC0XLCmahIgUHLhLOhpVCtw4CzYXvLQWQbJNmxoCsOKAxSgBJno75avolkRw8iIAFcsdc02e9iyCd8tHwmeSSoKTowIgvscSGZUOA7PuCN5b2BX9mQM7S0wYhMNU74zgsPBj3HU7wguAfnxxjFQGBE6pwN+GjME9zHY7zGp8wVxMShYX9NXvEWD3HbwJf4giO4CFIQxXScH1/TM+04kkBiAAAAAElFTkSuQmCC",U=()=>{try{const e=d.icon({iconUrl:S,shadowUrl:M,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});return d.Marker.prototype.options.icon=e,e}catch(e){return console.error("Error creating default icon:",e),null}};U();const k={pending:"#3b82f6",inprogress:"#f59e0b",solved:"#10b981",rejected:"#ef4444",default:"#9ca3af"},R=e=>{if(!e)return console.log("No location object provided"),null;if(console.log("Processing location object:",JSON.stringify(e,null,2)),typeof e.lat=="number"&&typeof e.lng=="number")return console.log("Using direct lat/lng properties"),[e.lat,e.lng];if(e.lat!==void 0&&e.lng!==void 0){console.log("Using string lat/lng properties");const u=parseFloat(e.lat),h=parseFloat(e.lng);if(!isNaN(u)&&!isNaN(h))return[u,h]}if(e.coordinates){if(e.coordinates.latitude!==void 0&&e.coordinates.longitude!==void 0)return console.log("Using coordinates.latitude/longitude"),[parseFloat(e.coordinates.latitude),parseFloat(e.coordinates.longitude)];if(Array.isArray(e.coordinates)&&e.coordinates.length===2)return console.log("Using coordinates array [lng, lat]"),[parseFloat(e.coordinates[1]),parseFloat(e.coordinates[0])]}return e.latitude!==void 0&&e.longitude!==void 0?(console.log("Using latitude/longitude properties"),[parseFloat(e.latitude),parseFloat(e.longitude)]):(console.log("No valid coordinate format found in location object"),null)},H=({complaints:e=[],onMarkerClick:u,className:h="h-96"})=>{const l=a.useRef(null),r=a.useRef(null),b=a.useRef({}),[g,N]=a.useState(!1),[w,C]=a.useState(!1),[p,v]=a.useState(null);return console.log("ComplaintsMap render",{complaintsCount:e?.length,isMounted:g,initialized:w,error:p}),a.useEffect(()=>{let i;return(()=>{if(!l.current){console.error("Map container ref is not available"),v("Map container not found");return}if(r.current){console.log("Map already initialized, skipping...");return}console.log("Initializing map..."),console.log("Container dimensions:",{width:l.current.offsetWidth,height:l.current.offsetHeight,style:window.getComputedStyle(l.current)});try{r.current=d.map(l.current,{center:[20.5937,78.9629],zoom:5,zoomControl:!0,attributionControl:!0,preferCanvas:!0,renderer:d.canvas(),fadeAnimation:!0,markerZoomAnimation:!0}),console.log("Map instance created:",r.current);const s=d.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"Â© OpenStreetMap contributors",maxZoom:19,detectRetina:!0,noWrap:!0}).addTo(r.current);console.log("Tile layer added:",s),N(!0),C(!0),v(null),i=setTimeout(()=>{console.log("Triggering map resize..."),r.current&&(r.current.invalidateSize(!0),console.log("Map size invalidated"))},100),console.log("Map initialized successfully"),setTimeout(()=>{console.log("Map container after init:",{container:l.current,map:r.current,size:r.current?.getSize(),bounds:r.current?.getBounds()})},200)}catch(s){if(console.error("Error initializing map:",s),v("Failed to initialize map. Please try again."),r.current){try{r.current.off(),r.current.remove()}catch(t){console.error("Error during map cleanup after error:",t)}r.current=null}}})(),()=>{if(console.log("Cleaning up map..."),i&&clearTimeout(i),r.current){try{r.current.off(),r.current.remove()}catch(s){console.error("Error during map cleanup:",s)}r.current=null}N(!1),C(!1)}},[]),a.useEffect(()=>{if(!r.current||!g||!w){console.log("Skipping marker update - map not ready");return}console.log("Updating markers..."),Object.entries(b.current).forEach(([t,o])=>{o&&r.current.hasLayer(o)&&r.current.removeLayer(o)}),b.current={};const i=[];let c=!1;const s=[];if(console.log("Processing complaints:",e),e.forEach(t=>{if(!t||!t.location){console.log("Skipping complaint - no location:",t?.id);return}try{console.log("Complaint location data:",{id:t.id,location:t.location,hasLatLng:t.location.lat!==void 0&&t.location.lng!==void 0,hasCoordinates:t.location.coordinates!==void 0});const o=R(t.location);if(console.log("Extracted coordinates:",o),!o||!Array.isArray(o)||o.length!==2){console.log("Invalid coordinates for complaint:",t.id,o);return}const[f,m]=o.map(Number);if(isNaN(f)||isNaN(m)){console.log("Invalid lat/lng values for complaint:",t.id,{lat:f,lng:m});return}console.log("Creating marker for complaint:",t.id,{lat:f,lng:m});const x=(t.status||"pending").toLowerCase(),z=k[x==="solved"?"solved":x]||k.default,A=d.marker([f,m],{icon:d.divIcon({html:`<div class="w-4 h-4 rounded-full border-2 border-white" style="background-color: ${z}"></div>`,className:"bg-transparent border-none",iconSize:[16,16],iconAnchor:[8,8]})}),y=`
          <div class="text-sm min-w-[200px] p-2">
            <p class="font-semibold truncate">${t.reason||"No title"}</p>
            <p class="mt-1">
              Status: 
              <span class="font-medium" style="color: ${z}">
                ${x.charAt(0).toUpperCase()+x.slice(1)}
              </span>
            </p>
            ${t.location?.name?`<p class="truncate">Location: ${t.location.name}</p>`:""}
            <button 
              class="mt-2 w-full px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200 transition-colors"
              onclick="window.dispatchEvent(new CustomEvent('marker-click', { detail: '${t.id}' }))"
            >
              View Details
            </button>
          </div>
        `;A.bindPopup(y),A.addTo(r.current),b.current[t.id]=A,i.push(A),s.push([f,m]),c=!0}catch(o){console.error("Error creating marker for complaint:",t?.id,o)}}),c&&s.length>0)try{const t=d.featureGroup(i);r.current.fitBounds(t.getBounds().pad(.2),{padding:[50,50],maxZoom:15})}catch(t){console.error("Error fitting bounds:",t)}},[e]),a.useEffect(()=>{const i=c=>{u&&c.detail&&u(c.detail)};return window.addEventListener("marker-click",i),()=>{window.removeEventListener("marker-click",i)}},[u]),a.useEffect(()=>{const i=c=>{const s=c?.detail;if(!s||!r.current)return;const t=b.current[s];if(t)try{const o=t.getLatLng();r.current.setView(o,16,{animate:!0}),t.openPopup&&t.openPopup()}catch(o){console.error("Failed to focus complaint marker",o)}};return window.addEventListener("focus-complaint",i),()=>window.removeEventListener("focus-complaint",i)},[]),console.log("Map render state:",{isMounted:g,initialized:w,error:p,complaintsCount:e?.length,mapRef:l.current?"Exists":"Null",mapInstance:r.current?"Exists":"Null"}),n.jsxs("div",{className:`w-full rounded-lg overflow-hidden shadow-md border border-gray-200 bg-gray-50 ${h}`,children:[p&&n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-6 text-center",children:[n.jsx("div",{className:"text-red-500 text-lg font-medium mb-2",children:"Error Loading Map"}),n.jsx("p",{className:"text-gray-600 mb-4",children:p}),n.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:"Reload Map"})]}),!g&&!p&&n.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center p-6",children:[n.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mb-4"}),n.jsx("p",{className:"text-gray-600",children:"Loading map..."})]}),n.jsx("div",{className:"relative w-full",style:{height:"400px"},children:n.jsx("div",{ref:l,className:"w-full h-full",style:{minHeight:"400px",backgroundColor:"#f0f0f0",position:"relative",zIndex:1},children:g&&!p&&n.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-blue-50 bg-opacity-50",children:n.jsxs("div",{className:"text-center p-4 bg-white rounded-lg shadow-lg",children:[n.jsx("p",{className:"font-medium",children:"Map is loading..."}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"If this message persists, check the console for errors"})]})})})}),n.jsx("style",{children:`
        .leaflet-container {
          width: 100% !important;
          height: 100% !important;
          min-height: 400px !important;
          z-index: 10;
        }
        .leaflet-tile {
          filter: none !important;
          -webkit-filter: none !important;
        }
      `})]})},O=E.memo(H);export{O as default};
